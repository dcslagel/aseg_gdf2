# aseg_gdf2

Python code to help read ASEG GDF2 packages. See the [ASEG technical standards](https://www.aseg.org.au/technical/aseg-technical-standards) page for more information about the file format.

Still very much a work in progress.

## Usage

```python
In [1]: import aseg_gdf2

In [2]: gdf = aseg_gdf2.read(r'tests/example_datasets/3bcfc711/GA1286_Waveforms')

In [3]: gdf.field_names()
Out[3]: ['FLTNUM', 'Rx_Voltage', 'Flight', 'Time', 'Tx_Current']

In [4]]: for row in gdf.iterrows():
   ...:     print(row)
   ...:
OrderedDict([('Index', 0), ('FLTNUM', 1.0), ('Rx_Voltage', -0.0), ('Flight', 1), ('Time', 0.0052), ('Tx_Current', 0.00176)])
OrderedDict([('Index', 1), ('FLTNUM', 1.0), ('Rx_Voltage', -0.0), ('Flight', 1), ('Time', 0.0104), ('Tx_Current', 0.00176)])
OrderedDict([('Index', 2), ('FLTNUM', 1.0), ('Rx_Voltage', -0.0), ('Flight', 1), ('Time', 0.0156), ('Tx_Current', 0.00176)])
...
```

For .dat files that will fit in memory, you can read them into a pandas.DataFrame:

```python
In [5]: gdf.df()
Out[5]:
       FLTNUM  Rx_Voltage  Flight     Time  Tx_Current
0         1.0        -0.0       1   0.0052     0.00176
1         1.0        -0.0       1   0.0104     0.00176
2         1.0        -0.0       1   0.0156     0.00176
3         1.0        -0.0       1   0.0208     0.00176
4         1.0        -0.0       1   0.0260     0.00176
5         1.0        -0.0       1   0.0312     0.00176
...       ...         ...     ...      ...         ...
23034     2.0         0.0       2  59.9687    -0.00170
23035     2.0        -0.0       2  59.9740    -0.00170
23036     2.0        -0.0       2  59.9792    -0.00170
23037     2.0        -0.0       2  59.9844    -0.00170
23038     2.0        -0.0       2  59.9896    -0.00170
23039     2.0        -0.0       2  59.9948    -0.00170

[23040 rows x 5 columns]
```

For .dat files that are too big for memory, you can use the ``chunksize=`` keyword argument to specify the number of rows. Normally you could get away with a few hundred thousand, but for the example we'll use something less:

```python
In [6]: for chunk in gdf.df_chunked(chunksize=10000):
    ...:     print('{} length = {}'.format(type(chunk), len(chunk)))
    ...:
<class 'pandas.core.frame.DataFrame'> length = 10000
<class 'pandas.core.frame.DataFrame'> length = 10000
<class 'pandas.core.frame.DataFrame'> length = 3040
```

The metadata from the .dfn file is there too:

```python
In [7]: gdf.record_types
Out[7]:
{'': {'fields': [{'cols': 1,
    'comment': '',
    'format': 'F10.1',
    'long_name': 'FlightNumber',
    'name': 'FLTNUM',
    'null': None,
    'unit': '',
    'width': 10},
   {'cols': 1,
    'comment': '',
    'format': 'F10.5',
    'long_name': 'Rx_Voltage',
    'name': 'Rx_Voltage',
    'null': '-99.99999',
    'unit': 'Volt',
    'width': 10},
   {'cols': 1,
    'comment': '',
    'format': 'I6',
    'long_name': 'Flight',
    'name': 'Flight',
    'null': '-9999',
    'unit': '',
    'width': 6},
   {'cols': 1,
    'comment': '',
    'format': 'F10.4',
    'long_name': 'Time',
    'name': 'Time',
    'null': '-999.9999',
    'unit': 'msec',
    'width': 10},
   {'cols': 1,
    'comment': '',
    'format': 'F13.5',
    'long_name': 'Tx_Current',
    'name': 'Tx_Current',
    'null': '-99999.99999',
    'unit': 'Amp',
    'width': 13}],
  'format': None}}
  ```

Get the data just for one field/column:

```python
In [8]: gdf.get_field('Time')
Out[8]:
array([  5.20000000e-03,   1.04000000e-02,   1.56000000e-02, ...,
         5.99844000e+01,   5.99896000e+01,   5.99948000e+01])
```

What about fields which are 2D arrays? Some GDF2 data files have fields with more than one value per row/record. e.g. in this one the last four fields each take up 30 columns:

```python
In [9]: gdf = aseg_gdf2.read(r'tests/example_datasets/9a13704a/Mugrave_WB_MGA52.dfn')

In [10]: print(gdf.dfn_contents)
```
```
DEFN   ST=RECD,RT=COMM;RT:A4;COMMENTS:A76
DEFN 1 ST=RECD,RT=;GA_Project:I10:Geoscience Australia airborne survey project number
DEFN 2 ST=RECD,RT=;Job_No:I10:SkyTEM Australia Job Number
DEFN 3 ST=RECD,RT=;Fiducial:F15.2:Fiducial
DEFN 4 ST=RECD,RT=;DATETIME:F18.10:UNIT=days,Decimal days since midnight December 31st 1899
DEFN 5 ST=RECD,RT=;LINE:I10:Line number
DEFN 6 ST=RECD,RT=;Easting:F12.2:NULL=-9999999.99,UNIT=m,Easting (GDA94 MGA Zone 52)
DEFN 7 ST=RECD,RT=;NORTH:F15.2:NULL=-9999999999.99,UNIT=m,Northing (GDA 94 MGA Zone 52)
DEFN 8 ST=RECD,RT=;DTM_AHD:F10.2:NULL=-99999.99,Digital terrain model (AUSGeoid09 datum)
DEFN 9  ST=RECD,RT=;RESI1:F10.3:NULL=-9999.999,Residual of data
DEFN 10 ST=RECD,RT=;HEIGHT:F10.2:NULL=-99999.99,UNIT=m,Laser altimeter measured height of Tx loop centre above ground
DEFN 11 ST=RECD,RT=;INVHEI:F10.2:NULL=-99999.99,UNIT=m,Calulated inversion height
DEFN 12 ST=RECD,RT=;DOI:F10.2:NULL=-99999.99,UNIT=m,Calculated depth of investigation
DEFN 13 ST=RECD,RT=;Elev:30F12.2:NULL=-9999999.99,UNIT=m,Elevation to the top of each layer
DEFN 14 ST=RECD,RT=;Con:30F15.5:NULL=-9999999.99999,UNIT=mS/m,Inverted Conductivity for each layer
DEFN 15 ST=RECD,RT=;Con_doi:30F15.5:NULL=-9999999.99999,UNIT=mS/m, Inverted conductivity for each layer, masked to the depth of investigation
DEFN 16 ST=RECD,RT=;RUnc:30F12.3:NULL=-999999.999,Relative uncertainty of conductivity layer;END DEFN
```

You can see the field names in the normal manner:

```python
In [11]: gdf.field_names()
Out[11]:
['GA_Project',
 'Job_No',
 'Fiducial',
 'DATETIME',
 'LINE',
 'Easting',
 'NORTH',
 'DTM_AHD',
 'RESI1',
 'HEIGHT',
 'INVHEI',
 'DOI',
 'Elev',
 'Con',
 'Con_doi',
 'RUnc']
 ```

 Or you can see an "expanded" version of the fields, which is used for the column headings of the data table:

 ```python
 In [12]: gdf.column_names()
Out[12]:
['GA_Project', 'Job_No', 'Fiducial', 'DATETIME', 'LINE', 'Easting', 'NORTH', 'DTM_AHD', 'RESI1',
 'HEIGHT', 'INVHEI', 'DOI', 'Elev[0]', 'Elev[1]', 'Elev[2]', 'Elev[3]', 'Elev[4]', 'Elev[5]',
 'Elev[6]', 'Elev[7]', 'Elev[8]', 'Elev[9]', 'Elev[10]', 'Elev[11]', 'Elev[12]', 'Elev[13]',
 'Elev[14]', 'Elev[15]', 'Elev[16]', 'Elev[17]', 'Elev[18]', 'Elev[19]', 'Elev[20]', 'Elev[21]',
 'Elev[22]', 'Elev[23]', 'Elev[24]', 'Elev[25]', 'Elev[26]', 'Elev[27]', 'Elev[28]', 'Elev[29]',
 'Con[0]', 'Con[1]', 'Con[2]', 'Con[3]', 'Con[4]', 'Con[5]', 'Con[6]', 'Con[7]', 'Con[8]', 'Con[9]',
 'Con[10]', 'Con[11]', 'Con[12]', 'Con[13]', 'Con[14]', 'Con[15]', 'Con[16]', 'Con[17]', 'Con[18]',
 'Con[19]', 'Con[20]', 'Con[21]', 'Con[22]', 'Con[23]', 'Con[24]', 'Con[25]', 'Con[26]', 'Con[27]',
 'Con[28]', 'Con[29]', 'Con_doi[0]', 'Con_doi[1]', 'Con_doi[2]', 'Con_doi[3]', 'Con_doi[4]',
 'Con_doi[5]', 'Con_doi[6]', 'Con_doi[7]', 'Con_doi[8]', 'Con_doi[9]', 'Con_doi[10]', 'Con_doi[11]',
 'Con_doi[12]', 'Con_doi[13]', 'Con_doi[14]', 'Con_doi[15]', 'Con_doi[16]', 'Con_doi[17]',
 'Con_doi[18]', 'Con_doi[19]', 'Con_doi[20]', 'Con_doi[21]', 'Con_doi[22]', 'Con_doi[23]',
 'Con_doi[24]', 'Con_doi[25]', 'Con_doi[26]', 'Con_doi[27]', 'Con_doi[28]', 'Con_doi[29]', 'RUnc[0]',
 'RUnc[1]', 'RUnc[2]', 'RUnc[3]', 'RUnc[4]', 'RUnc[5]', 'RUnc[6]', 'RUnc[7]', 'RUnc[8]', 'RUnc[9]',
 'RUnc[10]', 'RUnc[11]', 'RUnc[12]', 'RUnc[13]', 'RUnc[14]', 'RUnc[15]', 'RUnc[16]', 'RUnc[17]',
 'RUnc[18]', 'RUnc[19]', 'RUnc[20]', 'RUnc[21]', 'RUnc[22]', 'RUnc[23]', 'RUnc[24]', 'RUnc[25]',
 'RUnc[26]', 'RUnc[27]', 'RUnc[28]', 'RUnc[29]']

In [13]: gdf.df().head()
Out[13]:
   GA_Project  Job_No   Fiducial      DATETIME    LINE   Easting      NORTH  \
0        1288   10013  3621109.0  42655.910984  112601  948001.6  7035223.1
1        1288   10013  3621110.0  42655.910995  112601  948001.9  7035196.8
2        1288   10013  3621111.0  42655.911007  112601  948001.5  7035169.5
3        1288   10013  3621112.0  42655.911019  112601  948000.6  7035141.6
4        1288   10013  3621113.0  42655.911030  112601  947999.1  7035113.6

   DTM_AHD  RESI1  HEIGHT    ...     RUnc[20]  RUnc[21]  RUnc[22]  RUnc[23]  \
0    354.1  1.091   40.98    ...         1.39      1.76      2.35      3.26
1    353.8  1.101   41.08    ...         1.43      1.84      2.47      3.41
2    353.7  0.813   41.03    ...         1.45      1.88      2.53      3.48
3    353.9  0.567   40.79    ...         1.45      1.87      2.53      3.49
4    354.2  0.522   40.37    ...         1.45      1.88      2.54      3.52

   RUnc[24]  RUnc[25]  RUnc[26]  RUnc[27]  RUnc[28]  RUnc[29]
0      4.45      5.74      6.94      8.00      8.99      98.0
1      4.62      5.90      7.09      8.15      9.15      98.0
2      4.70      5.97      7.16      8.22      9.21      98.0
3      4.71      5.98      7.16      8.21      9.20      98.0
4      4.74      6.01      7.18      8.23      9.22      98.0

[5 rows x 132 columns]
```

You can retrieve one of the original field arrays using ``get_field()``:

```python
In [14]: gdf.get_field('Elev')
Out[14]:
array([[ 354.1,  352.1,  349.8, ..., -105.8, -171.2, -245.7],
       [ 353.8,  351.8,  349.5, ..., -106.1, -171.5, -246. ],
       [ 353.7,  351.7,  349.4, ..., -106.2, -171.6, -246.1],
       ...,
       [ 510.5,  508.5,  506.2, ...,   50.6,  -14.8,  -89.3],
       [ 510.5,  508.5,  506.2, ...,   50.6,  -14.8,  -89.3],
       [ 510.6,  508.6,  506.3, ...,   50.7,  -14.7,  -89.2]])
```

Or one of the columns:

```python
In [15]: gdf.get_field('Elev[0]')
Out[15]:
array([ 354.1,  353.8,  353.7,  353.9,  354.2,  354.5,  354.6,  354.7,
        354.6,  354.5,  354.3,  354.1,  353.9,  353.8,  353.9,  354. ,
        512.8,  512.6,  512.4,  512.3,  512.3,  512.5,  512.7,  512.9,
        512.9,  512.8,  512.6,  512.4,  512. ,  511.7,  511.4,  511.2,
        511. ,  510.6,  510.5,  510.5,  510.5,  510.6])
```

You can also retrieve a subset of fields and column names as a pandas.DataFrame using the [``usecols`` keyword argument](https://pandas.pydata.org/pandas-docs/version/0.22/generated/pandas.read_fwf.html) -- you don't necessarily need to retrieve the whole file at once. Note that the multidimensional ``'Con'`` field is expanded into the column names:

```python
In [6]: gdf.df(usecols=['Easting', 'NORTH', 'Con'])
Out[6]:
     Easting      NORTH    Con[0]    Con[1]    Con[2]     Con[3]     Con[4]  \
0   948001.6  7035223.1  28.76870  31.88776  46.04052   83.68201  157.48031
1   948001.9  7035196.8  31.06555  35.47357  51.17707   92.08103  165.37126
2   948001.5  7035169.5  38.18251  42.48088  59.91612  103.59474  174.79462
3   948000.6  7035141.6  47.61905  51.84033  70.17544  114.31184  178.79492
4   947999.1  7035113.6  58.58231  61.12469  77.45933  118.04982  173.64126
5   947997.2  7035085.9  62.93266  66.13757  80.38585  116.69973  164.66326
6   947995.1  7035058.5  59.27682  63.53240  77.51938  112.06993  155.83606
7   947993.4  7035031.3  51.12474  54.88474  68.77579  103.32713  145.45455
8   947992.5  7035004.2  42.21190  45.76659  59.73716   94.33962  136.29549
9   947992.5  7034976.6  35.05082  38.77472  52.27392   86.35579  131.78703
10  947993.3  7034948.3  32.00000  35.73981  48.49661   81.49959  128.20513
11  947994.7  7034919.2  32.01024  36.39010  48.99559   81.43322  126.13522
12  947996.0  7034889.4  35.02627  39.52569  52.38345   84.53085  125.14078
13  947997.1  7034859.0  39.68254  43.89816  56.65722   86.95652  122.71444
14  947997.8  7034828.4  44.01408  47.91567  60.38647   88.41733  119.26058
15  947997.9  7034797.9  46.64179  50.10020  61.50062   88.33922  116.91804
16  800001.6  7029884.1  38.55050  45.72474  59.34718   73.52941   81.83306
17  800002.4  7029855.3  36.71072  43.57298  57.04507   72.62164   83.96306
18  800003.0  7029826.9  34.16467  41.00041  54.64481   72.04611   86.35579
19  800003.5  7029798.6  32.32062  39.24647  53.53319   73.47539   90.90909
20  800003.5  7029770.1  31.61555  38.53565  53.53319   76.10350   96.80542
21  800003.3  7029741.5  32.19575  39.16960  55.06608   80.00000  102.60620
22  800002.9  7029712.8  33.56831  40.73320  57.87037   85.25149  107.99136
23  800002.8  7029684.3  34.07155  41.49378  59.66587   88.88889  110.90163
24  800002.8  7029656.1  32.92723  40.37142  58.51375   88.10573  110.08366
25  800003.1  7029628.1  32.20612  39.51008  57.04507   85.17888  104.44955
26  800003.7  7029600.1  31.54574  38.89537  55.74136   81.69935   98.42520
27  800004.1  7029572.0  31.83699  39.44773  55.77245   79.55449   93.89671
28  800004.3  7029543.8  34.11805  42.46285  58.54801   79.11392   88.96797
29  800004.5  7029515.5  38.08073  46.83841  62.18905   78.86435   84.67401
30  800004.4  7029487.4  42.35493  50.94244  65.23157   78.74016   81.90008
31  800004.2  7029459.7  44.46421  52.19207  65.65988   78.43137   81.10300
32  800004.1  7029432.1  44.18913  51.22951  64.80881   78.74016   82.16927
33  800004.1  7029404.5  40.88307  48.12320  62.38303   78.12500   82.30453
34  800003.9  7029376.8  36.20565  43.51610  58.17336   75.93014   81.63265
35  800003.7  7029348.7  32.05128  39.12363  54.22993   74.85030   83.54219
36  800003.3  7029320.2  30.16591  37.17472  52.54861   74.18398   83.68201
37  800002.6  7029291.4  30.49710  37.38318  52.32862   72.51632   80.97166

       Con[5]     Con[6]     Con[7]    ...        Con[20]    Con[21]  \
0   231.53508  242.01355  198.84669    ...      108.63661  145.39110
1   235.73786  237.41690  190.65777    ...      108.95620  144.84357
2   232.07241  225.88660  178.98693    ...      110.29006  146.09204
3   219.92523  212.44954  170.64846    ...      112.81588  148.58841
4   209.51184  204.49898  168.60563    ...      114.48197  150.03751
5   201.20724  203.16944  173.01038    ...      113.99909  149.25373
6   191.31433  200.84354  179.30787    ...      112.03227  146.86444
7   173.85257  188.67925  184.22992    ...      109.78153  144.27932
8   157.62926  173.49063  185.59762    ...      107.85160  142.40957
9   151.90643  167.70082  189.60940    ...      106.13458  140.70635
10  149.29830  165.09823  192.34468    ...      105.88734  140.15417
11  147.23204  165.20734  198.68865    ...      108.23682  141.82385
12  146.97237  171.20356  211.72983    ...      111.68193  144.65500
13  147.95088  181.09381  227.68670    ...      113.64928  146.82132
14  145.58160  186.08113  238.32221    ...      113.73976  148.56633
15  143.14343  185.83906  237.07918    ...      113.30161  150.37594
16   93.89671  116.44155  117.39845    ...       11.28159   14.90757
17   97.56098  115.15431  106.37166    ...        9.63391   12.76161
18  100.39153  111.18523   95.14748    ...        8.11030   10.75616
19  102.81719  104.72301   85.17888    ...        6.84932    9.09091
20  105.06409   97.37098   76.45260    ...        5.79710    7.71605
21  105.95465   89.68610   67.84261    ...        4.91642    6.55308
22  104.35146   81.16883   59.27682    ...        4.21230    5.61482
23  101.38903   74.68260   53.59057    ...        3.67377    4.89237
24   98.81423   71.63324   51.62623    ...        3.28947    4.37254
25   91.15770   65.53080   47.59638    ...        3.04507    4.03388
26   85.17888   61.50062   44.92363    ...        2.86862    3.76932
27   81.90008   60.06006   43.97537    ...        2.72257    3.53357
28   78.24726   59.03188   43.76368    ...        2.61301    3.34560
29   75.47170   58.68545   44.15011    ...        2.53293    3.20102
30   73.04602   57.37235   43.53505    ...        2.48016    3.10752
31   71.37759   55.52471   42.48088    ...        2.47586    3.06937
32   71.02273   54.52563   42.14075    ...        2.53421    3.08928
33   69.63788   53.27651   42.49894    ...        2.61165    3.15259
34   68.49315   52.96610   43.93673    ...        2.70343    3.23939
35   69.97901   54.73454   46.94836    ...        2.77701    3.32889
36   70.72136   57.11022   50.91650    ...        2.83688    3.41180
37   70.57163   59.03188   53.56186    ...        2.88434    3.47826

      Con[22]    Con[23]    Con[24]    Con[25]    Con[26]    Con[27]  \
0   181.29079  191.60759  178.44397  162.31131  152.43902  148.38997
1   179.79144  190.36741  177.99929  162.33766  152.55530  148.47810
2   179.88847  189.35808  177.11654  161.89089  152.46227  148.54427
3   180.31013  187.68769  175.37706  161.00467  152.23017  148.65468
4   180.21265  186.35855  174.27675  160.56519  152.23017  148.83167
5   179.56545  186.35855  174.70300  161.08247  152.62515  149.07573
6   178.38031  187.12575  176.21145  162.23232  153.25670  149.36520
7   177.30496  188.32392  178.09439  163.58580  153.96459  149.65579
8   177.05382  190.07793  180.21265  165.04374  154.72691  150.01500
9   176.95983  192.08605  182.64840  166.83350  155.76324  150.57973
10  176.86594  193.23671  184.43379  168.40687  156.91197  151.37754
11  177.05382  192.71536  184.53589  169.17611  157.92798  152.41579
12  177.84101  191.97543  184.19598  169.69286  158.90672  153.53908
13  179.62996  193.38619  185.52876  170.94017  160.00000  154.53562
14  183.18373  197.35544  188.35939  172.50302  160.84928  155.08685
15  187.44142  201.69423  190.83969  173.46054  161.10843  155.18312
16   22.77904   39.18495   72.04611  125.73871  164.66326  154.44015
17   19.68504   35.00175   69.54103  133.49353  177.11654  161.29032
18   16.71123   30.67485   66.62225  146.90760  199.68051  172.50302
19   14.21666   26.77376   62.85355  161.31634  229.88506  187.65247
20   12.16989   23.57934   59.80861  177.90429  264.83051  203.37604
21   10.41124   20.71680   56.98006  199.88007  309.02349  219.92523
22    8.96861   18.26818   54.31831  226.39801  358.68006  234.35669
23    7.84314   16.29992   51.86722  253.16456  403.71417  245.15813
24    7.04225   14.86326   49.70179  269.90553  427.71600  251.38260
25    6.50195   13.82170   46.57662  256.08195  424.80884  256.34453
26    6.04961   12.75022   41.75365  224.11475  431.59258  265.25199
27    5.60224   11.56604   36.12717  190.47619  446.03033  279.48575
28    5.23013   10.53075   31.25000  158.93198  446.82752  294.72443
29    4.92611    9.66184   27.24053  131.31976  444.64206  305.71691
30    4.71032    9.01713   24.22481  109.92635  429.36883  311.23561
31    4.58926    8.60585   22.18771   94.42871  400.48058  306.46644
32    4.56830    8.43170   21.03049   83.12552  352.11268  291.37529
33    4.62963    8.45309   20.47921   74.51565  294.20418  275.25461
34    4.73485    8.58369   20.29633   68.16633  244.49878  254.90696
35    4.85673    8.77963   20.41233   64.02049  205.42317  231.85718
36    4.98753    9.02527   20.78138   61.76652  178.50768  212.49469
37    5.09424    9.24214   21.16402   60.42296  162.44314  200.40080

      Con[28]    Con[29]
0   147.49263  147.42739
1   147.53615  147.47087
2   147.66686  147.62327
3   147.88524  147.86337
4   148.10427  148.08233
5   148.27995  148.23599
6   148.38997  148.32394
7   148.54427  148.43402
8   148.74312  148.63258
9   149.12019  148.94251
10  149.76786  149.54389
11  150.76134  150.51174
12  151.92950  151.69903
13  152.88182  152.67176
14  153.42129  153.25670
15  153.51551  153.37423
16  127.00025  110.81560
17  129.23236  111.33378
18  131.96094  111.49515
19  135.39128  111.64452
20  139.02405  112.10762
21  142.57200  112.59993
22  145.66642  113.30161
23  148.27995  114.19436
24  150.76134  115.43345
25  153.79883  116.95906
26  156.73981  118.00802
27  159.23567  118.32919
28  161.42050  118.34320
29  163.10553  118.25922
30  164.06891  117.98018
31  164.33854  117.74402
32  164.06891  117.70245
33  163.02576  117.73016
34  161.78612  117.84115
35  159.84655  118.21728
36  157.48031  118.69436
37  156.12802  119.20372

[38 rows x 32 columns]
```